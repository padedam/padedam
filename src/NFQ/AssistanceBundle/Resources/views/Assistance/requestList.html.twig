{%- macro stringMaxLength(request, maxLength) -%}
    {%- if request.longDescription | length < maxLength -%}
        <p class="btn-link" data-target="#m{{ request.id }}" data-toggle="modal">{{ request.longDescription }}</p>
    {%- else -%}
        <p class="btn-link" data-target="#m{{ request.id }}" data-toggle="modal">{{ request.longDescription|slice(0, maxLength) }}...</p>
    {%- endif -%}
    <div class="bs-component">
        <div id="m{{ request.id }}" class="modal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                        <h4 class="modal-title">{{ 'assistance.label_long_description'|trans }}</h4>
                    </div>
                    <div class="modal-body">
                        <fieldset>
                            {{ request.longDescription }}
                        </fieldset>
                    </div>
                    <div class="modal-footer">
                        <h4 class="text-left">{{ 'user.name'|trans }}: {{ request.getOwner().getFirstName() }}</h4>
                    </div>
                </div>
            </div>
        </div>
        <div style="display: none;" id="source-button" class="btn btn-primary btn-xs">&lt; &gt;</div></div>
{%- endmacro -%}

{% extends "::base.html.twig" %}

{% block body %}
    {% set my_requests = get_my_requests() %}
    {% if my_requests.status == 'success' and my_requests.data|length > 0 %}
        <div class="page-header col-md-10 col-md-offset-1">
            <h1 class="tables">{{ 'generic.assistance_my_req_list'|trans }}</h1>
        </div>
        <div class="row">
            <div class="col-md-10 col-md-offset-1">
                <div class="bs-component">
                    <table class="table table-striped table-hover ">
                        <thead>
                        <tr>
                            <th>{{ 'assistance.short_desc'|trans }}</th>
                            <th>{{ 'assistance.label_long_description'|trans }}</th>
                            <th>{{ 'generic.date'|trans }}</th>
                            <th>{{ 'assistances.table_actions_label'|trans }}</th>
                        </tr>
                        </thead>
                        <tbody>

                        {% for row in my_requests.data %}
                            <tr>
                                <td>{{ row.shortDescription }}</td>
                                <td>
                                    {{ _self.stringMaxLength(row, 50) }}
                                </td>
                                <td>{{ row.date|date('Y-m-d') }}</td>
                                <td>
                                {% if row.status == constant('NFQ\\AssistanceBundle\\Entity\\AssistanceRequest::STATUS_TAKEN') %}
                                    <a class="btn btn-success btn-sm" href="{{ url('nfq_review_create',
                                    {'arid': row.id}) }}">{{ 'assistances.table_actions_done'|trans }}</a>
                                    <a class="btn btn-danger btn-sm" href="{{ url('nfq_assistance_not_done',
                                    {'arid': row.id}) }}">{{ 'assistances.table_actions_not_done'|trans }}</a>
                                {% endif %}

                                {% if row.status == constant('NFQ\\AssistanceBundle\\Entity\\AssistanceRequest::STATUS_WAITING')
                                    or row.status == constant('NFQ\\AssistanceBundle\\Entity\\AssistanceRequest::STATUS_TAKEN')%}
                                    <a class="btn btn-primary btn-sm" href="{{ url('nfq_assistance_cancel',
                                    {'arid': row.id}) }}">{{ 'assistances.table_actions_cancel'|trans }}</a>
                                {% endif %}
                                </td>
                            </tr>
                        {% endfor %}

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    {% endif %}

    {% set takenRequests = get_my_taken_requests() %}
    {% if takenRequests.status == 'success' and takenRequests.data|length > 0 %}
        <div class="page-header col-md-10 col-md-offset-1">
            <h1 class="tables">{{ 'generic.assistance_taken_req_list'|trans }}</h1>
        </div>
        <div class="row">
            <div class="col-md-10 col-md-offset-1">
                <div class="bs-component">
                    <table class="table table-striped table-hover ">
                        <thead>
                        <tr>
                            <th>{{ 'assistance.owner_first_name'|trans }}</th>
                            <th>{{ 'assistance.short_desc'|trans }}</th>
                            <th>{{ 'assistance.label_long_description'|trans }}</th>
                            <th>{{ 'generic.date'|trans }}</th>
                            <th>{{ 'assistances.table_actions_label'|trans }}</th>
                        </tr>
                        </thead>
                        <tbody>

                        {% for row in takenRequests.data %}
                            <tr>
                                <td>{{ row.owner.firstName }}</td>
                                <td>{{ row.shortDescription }}</td>
                                <td>
                                    {{ _self.stringMaxLength(row, 50) }}
                                </td>
                                <td>{{ row.date|date('Y-m-d') }}</td>
                                <td>
                                    <a class="btn btn-primary btn-sm" href="{{ url('nfq_assistance_helper_cancel',
                                    {'arid': row.id}) }}">{{ 'assistances.table_actions_cancel'|trans }}</a>
                                </td>
                            </tr>
                        {% endfor %}

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    {% endif %}


    <div class="page-header col-md-10 col-md-offset-1">
        <h1 class="tables">{{ 'generic.assistance_req_list'|trans }}</h1>
    </div>
    <div class="row">
        <div class="col-md-10 col-md-offset-1">
            <div class="bs-component">
                <table class="table table-striped table-hover ">
                    <thead>
                    <tr>
                        <th>{{ 'assistance.owner_first_name'|trans }}</th>
                        <th>{{ 'assistance.short_desc'|trans }}</th>
                        <th>{{ 'assistance.label_long_description'|trans }}</th>
                        <th>{{ 'generic.date'|trans }}</th>
                        <th>{{ 'assistances.table_actions_label'|trans }}</th>
                    </tr>
                    </thead>
                    <tbody>

                    {% set waitingRequests = get_requests_for_me() %}
                    {% if waitingRequests.status == 'success' and waitingRequests.data|length > 0  %}
                        {% for row in waitingRequests.data %}
                            <tr>
                                <td>{{ row.owner.firstName }}</td>
                                <td>{{ row.shortDescription }}</td>
                                <td>
                                    {{ _self.stringMaxLength(row, 50) }}
                                </td>
                                <td>{{ row.date|date('Y-m-d') }}</td>
                                <td>
                                    <a class="btn btn-success btn-sm" href="{{ url('nfq_assistance_help',
                                    {'arid': row.id}) }}">{{ 'assistances.table_actions_help'|trans }}</a>
                                </td>
                            </tr>
                        {% endfor %}
                    {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

{% endblock %}